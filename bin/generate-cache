#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../config/environment'
require_relative '../lib/fedora_cache'
require 'optparse'

options = { overwrite: false, random: false }
parser = OptionParser.new do |option_parser|
  option_parser.banner = 'Usage: bin/generate-cache [options]'

  option_parser.on('-sSAMPLE', '--sample SAMPLE', Integer, 'Sample size, otherwise all druids.')
  option_parser.on('-o', '--overwrite', 'Overwrite cache for item if exists.')
  option_parser.on('-r', '--random', 'Select random druids.')
  option_parser.on('-h', '--help', 'Displays help.') do
    puts option_parser
    exit
  end
end
parser.parse!(into: options)

cache = FedoraCache.new(overwrite: options[:overwrite])

druids = File.read('druids.txt').split
druids.shuffle! if options[:random]
druids = druids.take(options[:sample]) if options[:sample]

druids.each_with_index do |druid, index|
  puts "#{druid} (#{index + 1})\n"
  cache.cache_object(druid)
  cache.cache_descmd(druid)
end
