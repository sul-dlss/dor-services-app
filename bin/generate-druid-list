#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../config/environment'
require 'set'

if ARGV.length != 1
  puts 'Usage: bin/generate-druid-list \'<QUERY, e.g., project_tag_ssim:"Naxos : born digital audio">\''
  exit(false)
end

query = ARGV[0]

druids = []

loop do
  results = ActiveFedora::SolrService.query('*:*', fl: 'id', rows: 10000, fq: query, start: druids.length, sort: 'id asc')
  break if results.empty?

  results.each { |r| druids << r['id'] }
  puts "Retrieved #{druids.length} druids"
  sleep(0.5)
end

File.open('druids.txt', 'w') do |file|
  druids.each do |druid|
    file.write("#{druid}\n")
  end
end
