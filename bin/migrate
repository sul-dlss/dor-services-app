#!/usr/bin/env ruby
# frozen_string_literal: true

# Use "export RUBYOPT='-W:no-deprecated -W:no-experimental'" in the shell to silence warnings when script starts

require_relative '../config/environment'
require_relative '../lib/fedora_migrator'
require 'optparse'

options = { druids: [], input: 'druids.txt' }
parser = OptionParser.new do |option_parser|
  option_parser.banner = 'Usage: bin/migrate [options]'

  option_parser.on('-sSAMPLE', '--sample SAMPLE', Integer, 'Sample size, otherwise all druids.')
  option_parser.on('-dDRUIDS', '--druids DRUIDS', Array, 'List of druids (instead of druids.txt).')
  option_parser.on('-iFILENAME', '--input FILENAME', String, 'File containing list of druids (instead of druids.txt).')
  option_parser.on('-h', '--help', 'Displays help.') do
    puts option_parser
    exit
  end
end

parser.parse!(into: options)

druids ||= if options[:druids].empty?
             file_druids = File.read(options[:input]).split
             if options[:sample]
               file_druids.take(options[:sample])
             else
               file_druids
             end
           else
             options[:druids]
           end

FedoraMigrator.new(druids: druids, results_folder: 'log/migration_results' ).run
