#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../../config/environment'
require_relative '../../lib/report'

Report.new(name: 'desc-invalid_note_types', dsids: ['descMetadata']).run do |ng_xml|
  invalid_types = [
    'Hydrus source id',
    'biographical /historical note',
    'note',
    'statement_of_responsibility'
  ].freeze

  xpath_predicate = invalid_types.map { |type| "@type='#{type}'" }.join(' or ')

  ng_xml
    .xpath("//mods:note[#{xpath_predicate}]", mods: MODS_NS)
    .map { |note_element| note_element.attribute('type').content }
    .join(';')
    .presence
end
