#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../../config/environment'
require_relative '../../lib/unique_report'

UniqueReport.new(name: 'top-level-desc-note_types', dsids: ['descMetadata']).run do |ng_xml|
  ng_xml.xpath('//mods:note/@type', mods: MODS_NS).filter_map do |note|
    note.content if note.ancestors.size == 3
    # why three ancestors indicates a note is at the top level? good question!
    # because (1) is the note itself (e.g. <note type="summary">A note</note>)
    # and (2) is the mods document
    # and (3) is the XML wrapper added by nokogiri
    # anything more than 3 levels means the note is not at the top level
  end
end
