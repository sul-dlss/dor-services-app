#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../../config/environment'
require_relative '../../lib/report'

Report.new(name: 'content-missing-imagedata-non-num', dsid: 'contentMetadata').run do |ng_xml|
  not_svg = '@mimetype!="image/svg+xml"'

  width = ng_xml.xpath("/contentMetadata/resource/file[#{not_svg}]/imageData/@width").presence&.first&.content
  height = ng_xml.xpath("/contentMetadata/resource/file[#{not_svg}]/imageData/@height").presence&.first&.content

  # we are interested in the ones that cannot be parsed as a Integer value
  Integer(width) if width.present?
  Integer(height) if height.present?
  false
rescue (ArgumentError)
  # we are interested in the ones that cannot be parsed as a Integer value
  true
end
