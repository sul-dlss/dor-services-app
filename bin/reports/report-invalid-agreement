#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../../config/environment'
require_relative '../../lib/report'

# see https://github.com/sul-dlss/dor-services-app/issues/3469, find agreements missing needed fedora-model:hasModel declaration
Report.new(name: 'invalid-agreement-relsext', dsid: 'RELS-EXT').run do |ng_xml|
  rdf_ns = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#'
  hydra_ns = 'http://projecthydra.org/ns/relations#'
  fedora_ns = 'info:fedora/fedora-system:def/model#'

  ng_xml.xpath(
    '//fedora:hasModel[@rdf:resource="info:fedora/afmodel:Dor_Agreement"]',
    hydra: hydra_ns, fedora: fedora_ns, rdf: rdf_ns
  ).blank?
end
