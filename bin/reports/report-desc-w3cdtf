#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../../config/environment'
require_relative '../../lib/report'

date_elements = %w[
  dateCreated
  dateIssued
  dateCaptured
  dateValid
  dateModified
  copyrightDate
  dateOther
].freeze

Report.new(name: 'desc-w3cdtf', dsids: ['descMetadata']).run do |ng_xml|
  mods_paths = date_elements.map { |element| "//mods:#{element}[@encoding='w3cdtf']" }.join(' | ')

  errors = ng_xml.xpath(mods_paths, mods: MODS_NS).filter_map do |element|
    DateTimeValidator.w3cdtf?(element.content) ? nil : element.content
  end

  errors.join(';').presence
end
